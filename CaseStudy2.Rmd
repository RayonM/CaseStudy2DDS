---
title: "CaseStudy2"
author: "Rayon M"
date: "7/19/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Introduction: The executive leadership has identified predicting employee turnover as its first application of data science for talent management. 


```{r}

library(tidyverse)
library(GGally)
library(naniar)
library(dplyr)
library(class)
library(caret)
library(e1071)
library(ggplot2)
library(plotly)

```

```{r}

employeeData = read.csv("C:/Users/Rayon/OneDrive/Documents/Doing DataScience/Doing Data Science/MSDS_6306_Doing-Data-Science/Unit 14 and 15 Case Study 2/CaseStudy2-data.csv")

view(employeeData)
```

#Exploraty Data Analysis(EDA)

```{r}

# Look at the structure of the data
str(employeeData)

# Review the data to see if there are any NA observed in the data set.
gg_miss_var(employeeData)

# The data set did not have any missing values!

#sapply(employeeData, function(x) sum(is.na(x)))

employeeData$Attrition <-  as.factor(employeeData$Attrition)


```

#observations
#"Years at Company" and "Years in Current Role" has a high yes attrition correlation value 0.822
#"Years at Company" and "Years Since last promotion" has a high yes attrition correlation value 0.755
#"Years at Company" and "Years with current manager" has a high yes attrition correlation value 0.768
#"Years in current role" and "Years Since last promotion" has a high yes attrition correlation value 0.667
#"Years in current role" and "Years with current manager" has a high yes attrition correlation value 0.811



```{r}

#Lets look do an EDA on each of the variables in the data set. 

employeeData %>% 
  ggplot(mapping = aes(x= JobSatisfaction))+
  geom_histogram(binwidth = 0.5)

employeeData %>% 
  ggplot(mapping = aes(y= JobSatisfaction))+
  geom_boxplot()
## Median of Job Satisfaction is 3

employeeData %>% 
  ggplot(mapping = aes(x= Education, color = Attrition))+
  geom_boxplot()

# Median of Education is 3.. range is 2, also it's the same for both Yes and No attrition

employeeData %>% 
  ggplot(mapping = aes(y= DailyRate))+
  geom_boxplot()
# Median of Daily rate is 800

employeeData %>% 
  group_by(Attrition) %>% 
  summarise(mean =  mean (DailyRate), sd = sd(DailyRate), median = median(DailyRate), range = max(DailyRate) -min(DailyRate), IQR = IQR(DailyRate), count = n())


(totals = count(employeeData, Attrition))


employeeData %>% 
  ggplot(mapping = aes(y= EmployeeCount))+
  geom_boxplot()
#Employee Count doesn't mean anything



employeeData %>% 
  ggplot(mapping = aes(x= Department))+
  geom_bar()

(totals = count(employeeData, Department))

totals %>% ggplot(mapping = aes(x = Department, y = n)) +
  geom_bar(stat = "identity")

# There are 3 departments


employeeData %>% ggplot (mapping = aes(x = DistanceFromHome,color = Attrition )) +
  geom_bar(position = "dodge")
#doesn't seem to be a strong relationship between Distance From Home and Attrition


employeeData %>% count(DistanceFromHome)



ggplot(data = employeeData) +
  geom_tile(mapping = aes(x = Department, y = BusinessTravel, fill = Attrition))

# People with technical Degrees in the Research and Sales department had attrition

employeeData %>% select(Attrition, JobSatisfaction, EducationField ) %>% ggpairs(aes(color = employeeData$Attrition))

  
employeeData %>% ggplot(mapping = aes(x = JobSatisfaction, y = EducationField, color = Attrition)) +
  geom_boxplot() +
  coord_flip()

# The median job satisfaction score of people who stay within Human Resources is 3.
# The median job satisfaction score of people who leave within Human Resources is 1.5


employeeData %>% ggplot(mapping = aes(x = JobLevel, y = JobSatisfaction, color = Attrition)) +
  geom_point(position = "jitter")


employeeData %>% ggplot(mapping = aes(x = EnvironmentSatisfaction, y = JobSatisfaction, color = Attrition)) +
  geom_point(position = "jitter")


#Monthly Income
ggplot(data = employeeData, mapping = aes(x = MonthlyIncome, ..density..))+ 
  geom_freqpoly(mapping = aes(color = Attrition), binwidth = 50)

#DailyRate
ggplot(data = employeeData, mapping = aes(x = DailyRate, ..density..))+ 
  geom_freqpoly(mapping = aes(color = Attrition), binwidth = 50)


#MonthlyRate
ggplot(data = employeeData, mapping = aes(x = MonthlyRate, ..density..))+ 
  geom_freqpoly(mapping = aes(color = Attrition), binwidth = 50)


employeeData %>% select (MonthlyIncome, MonthlyRate, DailyRate) %>% ggpairs(aes(color = employeeData$Attrition))


employeeData %>% 
  ggplot(mapping = aes(x = Attrition, y= DailyRate))+
  geom_boxplot(employeeData, mapping = aes(color = Attrition))


employeeData %>% select(Attrition, DistanceFromHome, MaritalStatus ) %>% ggpairs()

employeeData %>% select (WorkLifeBalance, YearsAtCompany, YearsInCurrentRole, YearsSinceLastPromotion, YearsWithCurrManager) %>% ggpairs(aes(color = employeeData$Attrition))



```

#KNN Model - K = 15

```{r}
STANDARDIZE YOUR VARIABLES!!!

#Monthly Attrition is one variable
#Overtime is another variable - Cannot work for KNN as it requires numeric values
#Job Satisfaction worked but not good enough. 20,15

#set.seed (9)
splitPerc = 0.70

trainIndices = sample(1:dim(employeeData)[1],round(splitPerc * dim(employeeData)[1]))
train = employeeData[trainIndices,]
test = employeeData[-trainIndices,]

# classifications = knn(train[,c(36,35,34,33,30,25,20,2,7)],test[,c(36,35,34,33,30,25,20,2,7)],train$Attrition, prob = TRUE, k = 20)
# table(test$Attrition,classifications)
# confusionMatrix(table(test$Attrition,classifications))



classifications = knn(train[,c(2,7,16,20,22,29,31,33,34,36)],test[,c(2,7,16,20,22,29,31,33,34,36)],train$Attrition, prob = TRUE, k = 20)
table(test$Attrition,classifications)
confusionMatrix(table(test$Attrition,classifications))

# classifications = knn(train[,c(15,16,24,32)],test[,c(15,16,24,32)],train$Attrition, k = 5, prob = TRUE)
# table(test$Attrition,classifications)
# confusionMatrix(table(test$Attrition,classifications))

# classifications = knn.cv(employeeData[,c(36,35,34,33,30,25,20)],employeeData$Attrition, k = 5)
# confusionMatrix(employeeData$Attrition,classifications)


#knn(train[,c(2,16,24)],test[,c(2,16,24)],train$Attrition, prob = TRUE, k = 3)]

# classifications = knn(train[,c("JobInvolvement","WorkLifeBalance","Age",  "JobLevel")],test[,c("JobInvolvement","WorkLifeBalance","Age",  "JobLevel")],train$Attrition, prob = TRUE, k = 15)
# table(test$Attrition,classifications)
# confusionMatrix(table(test$Attrition,classifications))

```

#Internal CV/ Leave One Out

```{r}
# classifications = knn.cv(employeeData[,c(2,7,16,20,22,29,31,33,34,36)],employeeData$Attrition, prob = TRUE, k = 20)
# table(employeeData$Attrition,classifications)
# confusionMatrix(table(employeeData$Attrition,classifications))


# classifications = knn.cv(employeeData[,c(36,35,34,33,30,25,20,2,7)],employeeData$Attrition, prob = TRUE, k = 20)
# table(employeeData$Attrition,classifications)
# confusionMatrix(table(employeeData$Attrition,classifications))


classifications = knn.cv(employeeData[,c("JobInvolvement","WorkLifeBalance","Age",  "JobLevel")], employeeData$Attrition, prob = TRUE, k = 15)
table(employeeData$Attrition,classifications)
confusionMatrix(table(employeeData$Attrition,classifications))


```


# Loop code for KNN

```{r}

#set.seed (6)

iterations = 500
numks = 30
masterAcc = matrix(nrow = iterations, ncol = numks)

splitPerc = 0.70

for(j in 1:iterations)
{
  accs = data.frame(accuracy = numeric(30), k = numeric(30))
  trainIndices = sample(1:dim(employeeData)[1],round(splitPerc * dim(employeeData)[1]))
  train = employeeData[trainIndices,]
  test = employeeData[-trainIndices,]
for(i in 1:numks) 
  
{
  # classifications = knn(train[,c("JobInvolvement","WorkLifeBalance","Age",  "JobLevel")],test[,c("JobInvolvement","WorkLifeBalance","Age","JobLevel")],train$Attrition, prob = TRUE, k = i)
  # table(test$Attrition,classifications)
  # cm = confusionMatrix(table(test$Attrition,classifications))
  # 
  # classifications = knn(train[,c(36,35,34,33,30,25,20,2,7)],test[,c(36,35,34,33,30,25,20,2,7)],train$Attrition, prob = TRUE, k = i)
  # table(test$Attrition,classifications)
  # cm = confusionMatrix(table(test$Attrition,classifications))
  # 
  classifications = knn(train[,c(2,7,16,20,22,29,31,33,34,36)],test[,c(2,7,16,20,22,29,31,33,34,36)],train$Attrition, prob = TRUE, k = i)
  table(test$Attrition,classifications)
  cm = confusionMatrix(table(test$Attrition,classifications))
  masterAcc[j,i] = cm$overall[1]
  
  #accs$accuracy[i] = cm$overall[1]
  #accs$k[i] = i

}

}

MeanAcc = colMeans(masterAcc)
#plot(accs$k, accs$accuracy, type ="l", xlab = "K")

plot(seq(1,numks, 1),MeanAcc, type = "l")

#accs


```



#NaiveBayes Model


```{r}

#set.seed (0)
splitPerc = 0.70

TrainIndices = sample(1:dim(employeeData)[1],round(splitPerc * dim(employeeData)[1]))
Train = employeeData[trainIndices,]
Test = employeeData[-trainIndices,]

# model = naiveBayes(train[,c(2,7,16,20,22,29,31,33,34,36)],train$Attrition)
# table(predict(model,test[,c(2,7,16,20,22,29,31,33,34,36)]),test$Attrition)
# confusionMatrix(table(predict(model,test[,c(2,7,16,20,22,29,31,33,34,36)]),test$Attrition))


# model = naiveBayes(train[,c(15,16,24,32)],train$Attrition)
# table(predict(model,test[,c(15,16,24,32)]),test$Attrition)
# confusionMatrix(table(predict(model,test[,c(15,16,24,32)]),test$Attrition))

# model = naiveBayes(train[,c(15,16,24,32)],train$Attrition)
# table(predict(model,test[,c(15,16,24,32)]),test$Attrition)
# confusionMatrix(table(predict(model,test[,c(15,16,24,32)]),test$Attrition))



#trainIndices = sample(seq(1:length(data$ID)), round(.7 * length(data$ID)))
#train = data[trainIndices,]
#test = data[-trainIndices,]
#model = naiveBayes(train[,c("JobInvolvement","WorkLifeBalance","OverTime","Age",  "JobLevel")],
                   #train$Attrition,
#CM = confusionMatrix(table(test$Attrition,labels = c("No","Yes")),
                           #predict(model,test[,c("JobInvolvement","WorkLifeBalance","OverTime","Age", "JobLevel")])))
#CM



#trainIndices = sample(seq(1:length(data$ID)), round(.7 * length(data$ID)))
#train = data[trainIndices,]
#test = data[-trainIndices,]

# model = naiveBayes(Train[,c("OverTime","Age",  "JobLevel")],Train$Attrition)
# CM = confusionMatrix(table(Test$Attrition,predict(model,Test[,c("OverTime","Age", "JobLevel")])))
# CM



# model = navieBayes(train[,c("Age", "DistanceFromHome",  "JobLevel", "MonthlyIncome", "TrainingTimesLastYear", "YearsAtCompany", "YearsInCurrentRole", "YearsWithCurrManager")], train$Attrition)
# CM = confusionMatrix(table(test$Attrition, predict(model,test[,c("Age", "DistanceFromHome",  "JobLevel", "MonthlyIncome", "TrainingTimesLastYear", "YearsAtCompany", "YearsInCurrentRole", "YearsWithCurrManager")])))
# CM

model = naiveBayes(train[,c("Age", "JobLevel", "MonthlyIncome", "OverTime")], train$Attrition)
CM = confusionMatrix(table(test$Attrition, predict(model,test[,c("Age",  "JobLevel", "MonthlyIncome", "OverTime")])))
CM

#Conclusion: My Explanatory Variables/Features are: Age, JobLevel, Monthly Income, and Overtime!



# "NumCompaniesWorked", "StockOptionLevel"
```


#GGPAIRS

```{r}

employeeData %>% 
  select (Attrition, YearsInCurrentRole, YearsSinceLastPromotion, YearsWithCurrManager) %>%
  ggpairs(mapping = aes(color = Attrition))

# Attrition looks to have the lowest median in the "Years in current role" variable and No Attrition have the highest, why?
# Attrition looks to have the lowest median in the "Years with Current Manager" and No Attrition have the highest, why?
# Attrition has a high correlation with "Years In current role" and Years with current manager? why? Overall the Correlation is 0.709 (Strong)
# Attrition has a medium correlation with "Years In current role" and Years since Last Promotion? why?

ggplot(data = employeeData, mapping = aes(x = YearsInCurrentRole, ..density..)) + 
  geom_freqpoly(mapping = aes(color = Attrition),binwidth = 1)

# The lower the "Years In Current Role" variable the more likely there is attrition -- which makes sense because people left before spending a long time. What else is driving them to leave?

ggplot(data = employeeData, mapping = aes(x = YearsInCurrentRole, y = YearsAtCompany)) +
  geom_point(position = "jitter")


employeeData %>% select(YearsAtCompany, YearsInCurrentRole) %>% 
  ggpairs(employeeData, mapping = aes(color = Attrition))
 

employeeData %>% 
  select (Attrition,TrainingTimesLastYear, WorkLifeBalance, YearsAtCompany, YearsInCurrentRole) %>%
  ggpairs(mapping = aes(color = Attrition))

# Years At Company and Years In current Role has a high correlation of 0.776; however, that's normally, as you need to be in the company to change roles. And the longer you stay the more likely.

employeeData %>% 
  select (Attrition, RelationshipSatisfaction, StandardHours, StockOptionLevel, TotalWorkingYears) %>% 
  ggpairs(mapping = aes(color = Attrition))

employeeData %>%
 select(Attrition, Over18, OverTime, PercentSalaryHike,PerformanceRating) %>%
  ggpairs(mapping = aes(color = Attrition))

#High correlation between Percent Salary Hike and Performance Rating - makes sense.

employeeData %>% select( Attrition,
  JobSatisfaction         
 ,MaritalStatus           
 ,MonthlyIncome           
 ,MonthlyRate
 ,NumCompaniesWorked) %>%
  ggpairs(mapping = aes(color = Attrition))

# Attrition folks have a lower monthly income

employeeData %>% select(
  Attrition
,Gender
,HourlyRate
,JobInvolvement          
,JobLevel                
,JobRole) %>%
  ggpairs(mapping = aes(color = Gender))

#The median job involvement for males were lowere than females

employeeData %>% select(
  Attrition
,Education               
 ,EducationField          
 ,EmployeeCount           
 ,EmployeeNumber          
 ,EnvironmentSatisfaction 
) %>%
  ggpairs(mapping = aes(color = Attrition))


employeeData %>% select(
 Attrition               
 ,BusinessTravel          
 ,DailyRate               
 ,Department              
 ,DistanceFromHome        

) %>%
  ggpairs(mapping = aes(color = Attrition))

#Business Travel has a lower Median for Attrition than non Attrition
#one department is seeing a high turnover 


ggplot(employeeData, mapping = aes(x=BusinessTravel)) +
  geom_bar(mapping =aes(color = Attrition), position = "dodge")

#Non-Travel, Travel_Frequently, Travel_rarely

ggplot(employeeData, mapping = aes(x=BusinessTravel, y = DistanceFromHome)) +
  geom_boxplot(mapping =aes(color = Attrition))
# people who work on average a further distance from home and don't travel have a high attrition!


ggplot(employeeData, mapping = aes(x=BusinessTravel, y = Department)) +
  geom_tile(mapping =aes())+
  coord_flip()

employeeData %>% 
  count(BusinessTravel, Department) %>%
  ggplot(mapping = aes(x = BusinessTravel, y = Department)) +
  geom_tile(mapping = aes(fill = n))


```



# Categorical Variables

```{r}
# Attrition               
# BusinessTravel          
# Department          
# EducationField         
# Gender
# JobRole           
# MaritalStatus
# Over18                
# OverTime

```

# Attrition               

```{r}
ggplot(data = employeeData) +
    geom_bar(mapping = aes(x = Attrition, fill = Attrition))
# Attrition is mostly no in the data set. Heavily unbalanced towards no.

employeeData %>% count(Attrition)

#  Attrition   n
# 1        No 730
# 2       Yes 140

```

# BusinessTravel          

```{r}
ggplot(data = employeeData) +
  geom_bar(mapping = aes(x = BusinessTravel, fill = Attrition), position ="dodge")+
  facet_wrap(~Attrition)

#What is the correlation between Business Travel and Attrition?

employeeData %>% select(Attrition, BusinessTravel) %>% ggpairs()

ggplot(data = employeeData) +
  geom_count(mapping = aes(x = BusinessTravel, y= Attrition), position ="dodge")

p = employeeData %>% count(Attrition, BusinessTravel) %>% 
  ggplot(mapping = aes(x= BusinessTravel, y = Attrition))+
  geom_tile(mapping = aes(fill = n))
 
ggplotly(p)

employeeData %>% filter(Attrition == "Yes") %>% count(BusinessTravel)
#      BusinessTravel  n
# 1        Non-Travel 11
# 2 Travel_Frequently 35
# 3     Travel_Rarely 94

# Conclusion: Business Travel does not affect Attrition. I would've expected to see more in the Attrition field if that was the case for Travel Frequently.


```

# Department          

```{r}
ggplot(data = employeeData) +
  geom_bar(mapping = aes(x = Department))+
  facet_wrap(~Attrition)


#What job roles comprises within each Departments?
z = employeeData %>% count(JobRole, Department, Attrition) %>% 
  ggplot(mapping = aes(x= Department, y = JobRole))+
  geom_tile(mapping = aes(fill = n))+
   facet_wrap(~Attrition)
ggplotly(z)


#Why are sales people leaving?

sales_data <- employeeData %>% filter(Department == "Sales")

sales_data %>% select(Attrition, JobSatisfaction, MonthlyIncome, WorkLifeBalance, PercentSalaryHike,PerformanceRating) %>% ggpairs(mapping = aes(color = Attrition))

# The correlation between PercentSaleryHike and Performance Rating is strong. 0.767. More of it is shown below.

employeeData %>% ggplot(mapping = aes(x = PercentSalaryHike, y = PerformanceRating)) +
  geom_point(mapping = aes(color = Attrition, alpha = JobRole),position = "jitter" )+
  geom_smooth(method = "lm", se = FALSE, color = "red")+
  coord_flip()
# This makes sense as the higher the performance rating the better the percentage hike!



# Whats the correlation between the Department and Attrition?

ggplot(data = employeeData) +
  geom_count(mapping = aes(x = Department, y= Attrition), position ="dodge")

Department = employeeData %>% count(Attrition, Department) %>% 
  ggplot(mapping = aes(x= Department, y = Attrition))+
  geom_tile(mapping = aes(fill = n))


 
ggplotly(Department)

employeeData %>% filter(Attrition == "Yes") %>% count(Department)

# 1        Human Resources  6
# 2 Research & Development 75
# 3                  Sales 59


# Conclusion: Department does not affect Attrition. I would've expected to see more in the Attrition field if that was the case. However, there's a trend developing in the Sales department, as more Sales Representative are leaving the company. 

```

# EducationField         


```{r}
ggplot(data = employeeData) +
  geom_bar(mapping = aes(x = EducationField, fill = Attrition), position ="dodge")


#What is the correlation between Education Field and Job Satisfaction and Job Role?

employeeData %>% select (Attrition, EducationField, JobSatisfaction, JobRole ) %>% ggpairs(mapping = aes(color = Attrition))

employeeData %>% ggplot(mapping = aes(x = EducationField, y = JobSatisfaction)) +
  geom_boxplot(mapping = aes(color = Attrition))

#  Person with low median in Human Resources.


```

# Gender


```{r}
ggplot(data = employeeData) +
  geom_bar(mapping = aes(x = Gender, fill = Attrition), position ="dodge")

```

# JobRole           

```{r}
ggplot(data = employeeData) +
  geom_bar(mapping = aes(x = JobRole, fill = Attrition), position ="dodge")



```

# MaritalStatus

```{r}
ggplot(data = employeeData) +
  geom_bar(mapping = aes(x = MaritalStatus, fill = Attrition), position = "dodge")

employeeData %>% count(MaritalStatus)
#   MaritalStatus   n
# 1      Divorced 191
# 2       Married 410
# 3        Single 269

#Is there a correlation between marriage status and Attrition?

employeeData %>% ggplot(mapping = aes(x = Attrition, y = MaritalStatus)) +
  geom_boxplot(mapping = aes(color = Attrition))

```

# Over18                

```{r}
ggplot(data = employeeData) +
  geom_bar(mapping = aes(x = Over18, fill = Attrition), position ="dodge")

employeeData %>% count(Over18) #All employees are over the age of 18

```

# OverTime

```{r}
ggplot(data = employeeData) +
  geom_bar(mapping = aes(x = OverTime))+
  facet_wrap(~Attrition)

employeeData %>% count(OverTime)
# 
#   OverTime   n
# 1       No 618
# 2      Yes 252

# Were the people who work overtime montly salary higher than those that didn't?

employeeData %>% ggplot(mapping = aes(x = MonthlyIncome, alpha = OverTime, fill = Attrition)) +
  geom_histogram()
  

employeeData %>% ggplot(mapping = aes(x = MonthlyIncome, alpha = OverTime, fill = Attrition)) +
  geom_boxplot()+
  coord_flip()

# The median of those that that ha

#Monthly income does contribute to Attrition.

```



# Continuous Variables


```{r}

 # $ Age                     
 # $ DailyRate               
 # $ DistanceFromHome        
 # $ Education               
 # $ EmployeeCount           
 # $ EmployeeNumber #skipped          
 # $ EnvironmentSatisfaction 
 # $ HourlyRate              
 # $ JobInvolvement          
 # $ JobLevel                
 # $ JobSatisfaction         
 # $ MonthlyIncome           
 # $ MonthlyRate             
 # $ NumCompaniesWorked      
 # $ PercentSalaryHike       
 # $ PerformanceRating       
 # $ RelationshipSatisfaction
 # $ StandardHours           
 # $ StockOptionLevel        
 # $ TotalWorkingYears       
 # $ TrainingTimesLastYear   
 # $ WorkLifeBalance         
 # $ YearsAtCompany          
 # $ YearsInCurrentRole      
 # $ YearsSinceLastPromotion 
 # $ YearsWithCurrManager    

ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = Age), binwidth = 0.5)

employeeData %>% 
  count(cut_width(Age, 1))

ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = DailyRate), binwidth = 15)

employeeData %>% 
  count(cut_width(DailyRate, 1))

```{r}

ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x =  DistanceFromHome, fill = DistanceFromHome))

employeeData %>% 
  count(cut_width(DistanceFromHome, 1))

# Mode around 1.5 to 2.5 has about 133 values included
```

```{r}
ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x =  Education ))

# Ranges from 1 to 5


# ggplot(data = employeeData) +
#   geom_histogram(mapping = aes(x =  EmployeeCount )) # Doesn't do anything

ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x =  EnvironmentSatisfaction  ))

# Ranges from 1 to 4


ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = HourlyRate ))


ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = JobInvolvement))
# Ranges from 1 to 4


ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = JobLevel))

# Ranges from 1 to 5

ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = MonthlyIncome ))

ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = MonthlyRate))


ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = NumCompaniesWorked ))

```

#Performance Rating

```{r}
ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = PerformanceRating))+
  facet_wrap(~Attrition)

employeeData %>% filter(employeeData$Attrition == "Yes") %>%
  count(cut_width(PerformanceRating, 1))

# Attrition and Non Attrition Employees all receive a rating of 3 or 4.
# Roughly over 600+ Non Attrition Employees got a rating of 3
# Roughly over 100+ Non Attrition Employees got a rating of 4 (very small percentage)

# Slightly over 100+ Attrition Employees got a rating of 3
# Significantly less 50 Attrition Employees got a rating of 4 (very small percentage)


```

#PercentSalaryHike 
Would love to compare this with the Position or title to see the Correlation 

```{r}
ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = PercentSalaryHike), binwidth = 0.5)+
  facet_wrap(~Attrition)

employeeData %>% filter(Attrition == "No") %>%
  count(cut_width(PercentSalaryHike, 0.5))

#    cut_width(PercentSalaryHike, 0.5)   n
# 1                        [10.8,11.2] 126
# 2                        (11.8,12.2] 119
# 3                        (12.8,13.2] 123
# 4                        (13.8,14.2] 120
# 5                        (14.8,15.2]  54
# 6                        (15.8,16.2]  43
# 7                        (16.8,17.2]  56
# 8                        (17.8,18.2]  57
# 9                        (18.8,19.2]  40
# 10                       (19.8,20.2]  27
# 11                       (20.8,21.2]  33
# 12                       (21.8,22.2]  30
# 13                       (22.8,23.2]  17
# 14                       (23.8,24.2]  14
# 15                       (24.8,25.2]  11


# > employeeData %>% filter(Attrition == "Yes") %>%
# +   count(cut_width(PercentSalaryHike, 0.5))
#    cut_width(PercentSalaryHike, 0.5)  n
# 1                        [10.8,11.2] 24
# 2                        (11.8,12.2] 17
# 3                        (12.8,13.2] 21
# 4                        (13.8,14.2] 13
# 5                        (14.8,15.2]  8
# 6                        (15.8,16.2] 10
# 7                        (16.8,17.2] 10
# 8                        (17.8,18.2]  9
# 9                        (18.8,19.2]  5
# 10                       (19.8,20.2]  3
# 11                       (20.8,21.2]  2
# 12                       (21.8,22.2]  7
# 13                       (22.8,23.2]  5
# 14                       (23.8,24.2]  5
# 15                       (24.8,25.2]  1


```


#RelationshipSatisfaction

```{r}
ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = RelationshipSatisfaction), binwidth = 0.1)+
  facet_wrap(~Attrition)

employeeData %>% filter(Attrition == "Yes") %>%
  count(cut_width(RelationshipSatisfaction, 0.1))
# 
# > employeeData %>% filter(Attrition == "Yes") %>%
# +   count(cut_width(RelationshipSatisfaction, 0.5))
#   cut_width(RelationshipSatisfaction, 0.5)  n
# 1                              [0.75,1.25] 35
# 2                              (1.75,2.25] 27
# 3                              (2.75,3.25] 36
# 4                              (3.75,4.25] 42


```


#StandardHours

```{r}
ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = StandardHours), binwidth = 0.1)+
  facet_wrap(~Attrition)

employeeData %>% filter(Attrition == "Yes") %>%
  count(cut_width(StandardHours, 0.1))

```


#StockOptionLevel

```{r}

ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = StockOptionLevel), binwidth = 0.1)+
  facet_wrap(~Attrition)

employeeData %>% filter(Attrition == "Yes") %>%
  count(cut_width(StockOptionLevel, 0.1))

```


#TotalWorkingYears

```{r}

ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = TotalWorkingYears), binwidth = 0.1)+
  facet_wrap(~Attrition)

employeeData %>% filter(Attrition == "Yes") %>%
  count(cut_width(TotalWorkingYears, 0.1))

```

#TrainingTimesLastYear

 
```{r}

ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = TrainingTimesLastYear), binwidth = 0.1)+
  facet_wrap(~Attrition)

employeeData %>% filter(Attrition == "Yes") %>%
  count(cut_width(TrainingTimesLastYears, 0.1))
 
```
 
#WorkLifeBalance
 
 
```{r}
ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = WorkLifeBalance ), binwidth = 0.1)+
  facet_wrap(~Attrition)

employeeData %>% filter(Attrition == "Yes") %>%
  count(cut_width(WorkLifeBalance , 0.1))
 

```

#YearsAtCompany
 
```{r}

ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = YearsAtCompany), binwidth = 0.1)+
  facet_wrap(~Attrition)

employeeData %>% filter(Attrition == "Yes") %>%
  count(cut_width(YearsAtCompany , 0.1))


```

#YearsInCurrentRole

```{r}

ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = YearsInCurrentRole), binwidth = 0.1)+
  facet_wrap(~Attrition)

employeeData %>% filter(Attrition == "Yes") %>%
  count(cut_width(YearsInCurrentRole , 0.1))


```



#YearsSinceLastPromotion
 
 
```{r}
ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = YearsSinceLastPromotion), binwidth = 0.5)+
  facet_wrap(~Attrition)

employeeData %>% filter(Attrition == "Yes") %>%
  count(cut_width(YearsSinceLastPromotion , 0.5))

```

#YearsWithCurrManager


```{r}
ggplot(data = employeeData) +
  geom_histogram(mapping = aes(x = YearsWithCurrManager), binwidth = 0.5)+
  facet_wrap(~Attrition)

employeeData %>% filter(Attrition == "Yes") %>%
  count(cut_width(YearsWithCurrManager , 0.5))

```

```{r}

 # $ MonthlyIncome           
 # $ PercentSalaryHike       
 # $ TotalWorkingYears       
 # $ YearsAtCompany          
 # $ YearsInCurrentRole      
 # $ YearsSinceLastPromotion 
 # $ YearsWithCurrManager    

employeeData %>% select(Attrition, MonthlyIncome,PercentSalaryHike, TotalWorkingYears,YearsAtCompany,YearsInCurrentRole,YearsSinceLastPromotion ,YearsWithCurrManager)%>%
  ggpairs(mapping = aes(color = Attrition))

employeeData %>% 
select(Attrition                     
 ,Age                     
 ,DistanceFromHome
 ,JobLevel
 ,MonthlyIncome
 ,NumCompaniesWorked
 ,StockOptionLevel #iffy
 ,TrainingTimesLastYear
 ,YearsAtCompany          
 ,YearsInCurrentRole      
 ,YearsWithCurrManager 
 ) %>%
  ggpairs(mapping = aes(color = Attrition))

employeeData %>%
  select(Attrition, JobInvolvement,WorkLifeBalance,OverTime, Age,  JobLevel) %>%
  ggpairs(mapping = aes(color = Attrition))


employeeData %>%
  group_by(Attrition)%>%
  summarise(median = median(Age))
#  Attrition median
#   <chr>      <dbl>
# 1 No            36
# 2 Yes           32

log-log transformation
employeeData %>%
  mutate (lcarat = log(carat), lprice = log(price))%>%
  ggplot(aes(x = lcarat, y = lprice))+
  geom_point()

```


```{r}
# Those that left the company were on average younger that those that stayed. (AGE)
# Those that left the company lived far away from the company on average than those that stay(DistanceFromHome)
# Job level was significantly lower for those left than those that stayed.
## Hourly rate of those that left were higher on Average.
# The Monthly Income of those that left the company were lower than those that stayed on average.
# Job level had a high correlation with Monthly Income of (0.952)
# Monthly income and Age correlated at about 50%
# JobLevel and Age correlated at about 50%
# Those Employees that left the company had  worked at fever companies on average than those that stayed.
# THose that that left the company had a lower stock option level on average.
# The employees that left the company had a lower Total# of working years than those that stayed. TotalWorking Years had a strong correlation with Age, joblevel, MonthlyIncome.
# Those that left the company had fewer training on average in the last year than those that stayed.
#Those that left the company had fewer years at the company on average than those that stayed.
#Those that left the company had fewer years in the current role on average than those that stayed.
#Those that left the company had fewer years with the current manager on average than those that stayed.



```

